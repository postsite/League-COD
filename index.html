<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>League COD Amateur</title>
<style>
/* -------------------- STYLES G√âN√âRAUX -------------------- */
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #000;
    color: #fff;
    scroll-behavior: smooth;
}

/* -------------------- HEADER -------------------- */
header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #4B0082;
    padding: 10px 20px;
    position: sticky;
    top: 0;
    z-index: 1000;
}

header img {
    height: 60px;
}

nav {
    display: flex;
    gap: 10px;
}

nav button {
    background-color: #FFD700;
    color: #000;
    border: none;
    padding: 8px 12px;
    font-weight: bold;
    cursor: pointer;
    border-radius: 5px;
}

nav button:hover {
    background-color: #FFC300;
}

.admin-btn, .inscrire-btn {
    cursor: pointer;
    font-weight: bold;
    background-color: #FFD700;
    color: #000;
    border: none;
    padding: 10px 15px;
    font-size: 16px;
    border-radius: 5px;
    transition: background-color 0.2s;
    margin-left: 5px;
}

.admin-btn:hover, .inscrire-btn:hover {
    background-color: #FFC300;
}

/* -------------------- BANNI√àRE -------------------- */
.banner img {
    width: 100%;
    max-height: 300px;
    object-fit: cover;
}

/* -------------------- SECTIONS -------------------- */
section {
    padding: 40px 20px;
    border-bottom: 2px solid #FFD700;
}

section h2 {
    color: #FFD700;
}

/* -------------------- √âDITION ADMIN -------------------- */
.editable {
    outline: 2px dashed #FFD700;
    padding: 10px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 5px;
    min-height: 70px;
    position: relative;
}

.editor-toolbar {
    display: none;
    background-color: #4B0082;
    padding: 5px;
    border-radius: 5px;
    margin-bottom: 5px;
    white-space: nowrap;
}

.editor-toolbar button {
    margin: 0 2px;
    background-color: #FFD700;
    color: #000;
    border: none;
    padding: 3px 6px;
    cursor: pointer;
    border-radius: 3px;
}

.editor-toolbar button:hover {
    background-color: #FFC300;
}

.editable-content {
    min-height: 50px;
    outline: none;
    font-size: 20px;
}

/* -------------------- FOOTER -------------------- */
footer {
    background-color: #4B0082;
    padding: 20px;
    text-align: center;
}

.socials {
    display: flex;
    justify-content: center;
    gap: 15px;
    padding: 10px 0;
}

.socials a img {
    width: 40px;
    height: 40px;
    object-fit: contain;
    cursor: pointer;
    transition: transform 0.2s;
}

.socials a img:hover {
    transform: scale(1.1);
}

/* -------------------- MODALES -------------------- */
#adminModal, #inscrireModal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.85);
    justify-content: center;
    align-items: center;
}

.modal-content {
    background-color: #1a1a1a;
    border: 2px solid #FFD700;
    border-radius: 10px;
    padding: 30px;
    width: 320px;
    text-align: center;
    box-shadow: 0 0 15px #FFD700;
    animation: fadeIn 0.3s ease;
}

#adminModal input, #inscrireModal input {
    width: 80%;
    padding: 10px;
    margin: 15px 0;
    border-radius: 5px;
    border: none;
    font-size: 16px;
}

#togglePassword {
    background:#555;
    color:#fff;
    margin-left:5px;
}

/* -------------------- ANIMATIONS -------------------- */
@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

.admin-alert {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 20px;
    border-radius: 8px;
    font-weight: bold;
    z-index: 3000;
    animation: slideIn 0.4s ease;
}

.admin-alert.success {
    background-color: #4CAF50;
    color: #fff;
    border: 2px solid #2E7D32;
}

.admin-alert.error {
    background-color: #E53935;
    color: #fff;
    border: 2px solid #B71C1C;
}

@keyframes slideIn {
    from { opacity: 0; right: -50px; }
    to { opacity: 1; right: 20px; }
}
</style>
</head>
<body>

<!-- -------------------- HEADER -------------------- -->
<header>
    <img src="Logo.png" alt="Logo">
    <nav>
        <button onclick="scrollToSection('presentation')">Pr√©sentation</button>
        <button onclick="scrollToSection('regles')">R√®gles</button>
        <button onclick="scrollToSection('equipes')">√âquipes</button>
        <button onclick="scrollToSection('joueurs')">Joueurs</button>
        <button onclick="scrollToSection('resultats')">R√©sultats</button>
        <button onclick="scrollToSection('saison3')">Saison 3</button>
    </nav>
    <div>
        <button class="admin-btn" onclick="openAdminModal()">‚öôÔ∏è Admin</button>
        <button class="inscrire-btn" onclick="openInscrireModal()">üìù S'inscrire</button>
    </div>
</header>

<!-- -------------------- BANNI√àRE -------------------- -->
<div class="banner">
    <img src="Banni√®re.png" alt="Banni√®re">
</div>

<!-- -------------------- SECTIONS -------------------- -->
<section id="presentation">
    <h2>Pr√©sentation</h2>
    <div class="editable" id="editable-presentation">
        <div class="editor-toolbar">
            <button onclick="formatText('bold', event, this)">B</button>
            <button onclick="formatText('italic', event, this)">I</button>
            <button onclick="formatText('underline', event, this)">U</button>
            <button onclick="formatText('increaseFont', event, this)">A+</button>
            <button onclick="formatText('decreaseFont', event, this)">A-</button>
        </div>
        <div class="editable-content" contenteditable="false">
            Bienvenue sur la League COD Amateur, le championnat des meilleurs joueurs amateurs !
        </div>
    </div>
</section>

<section id="regles">
    <h2>R√®gles</h2>
    <div class="editable" id="editable-regles">
        <div class="editor-toolbar">
            <button onclick="formatText('bold', event, this)">B</button>
            <button onclick="formatText('italic', event, this)">I</button>
            <button onclick="formatText('underline', event, this)">U</button>
            <button onclick="formatText('increaseFont', event, this)">A+</button>
            <button onclick="formatText('decreaseFont', event, this)">A-</button>
        </div>
        <div class="editable-content" contenteditable="false">
            Les r√®gles sont simples : fair-play et comp√©tition amicale.
        </div>
    </div>
</section>

<section id="equipes">
    <h2>√âquipes</h2>
    <div class="editable" id="editable-equipes">
        <div class="editor-toolbar">
            <button onclick="formatText('bold', event, this)">B</button>
            <button onclick="formatText('italic', event, this)">I</button>
            <button onclick="formatText('underline', event, this)">U</button>
            <button onclick="formatText('increaseFont', event, this)">A+</button>
            <button onclick="formatText('decreaseFont', event, this)">A-</button>
        </div>
        <div class="editable-content" contenteditable="false">
            Voici les √©quipes participantes de cette saison.
        </div>
    </div>
</section>

<section id="joueurs">
    <h2>Joueurs</h2>
    <div class="editable" id="editable-joueurs">
        <div class="editor-toolbar">
            <button onclick="formatText('bold', event, this)">B</button>
            <button onclick="formatText('italic', event, this)">I</button>
            <button onclick="formatText('underline', event, this)">U</button>
            <button onclick="formatText('increaseFont', event, this)">A+</button>
            <button onclick="formatText('decreaseFont', event, this)">A-</button>
        </div>
        <div class="editable-content" contenteditable="false">
            D√©couvrez les joueurs et leurs statistiques.
        </div>
    </div>
</section>

<section id="resultats">
    <h2>R√©sultats</h2>
    <div class="editable" id="editable-resultats">
        <div class="editor-toolbar">
            <button onclick="formatText('bold', event, this)">B</button>
            <button onclick="formatText('italic', event, this)">I</button>
            <button onclick="formatText('underline', event, this)">U</button>
            <button onclick="formatText('increaseFont', event, this)">A+</button>
            <button onclick="formatText('decreaseFont', event, this)">A-</button>
        </div>
        <div class="editable-content" contenteditable="false">
            Les r√©sultats des matchs seront publi√©s ici.
        </div>
    </div>
</section>

<section id="saison3">
    <h2>Saison 3</h2>
    <div class="editable" id="editable-saison3">
        <div class="editor-toolbar">
            <button onclick="formatText('bold', event, this)">B</button>
            <button onclick="formatText('italic', event, this)">I</button>
            <button onclick="formatText('underline', event, this)">U</button>
            <button onclick="formatText('increaseFont', event, this)">A+</button>
            <button onclick="formatText('decreaseFont', event, this)">A-</button>
        </div>
        <div class="editable-content" contenteditable="false">
            Bienvenue dans la saison 3 de la League COD Amateur !
        </div>
    </div>
</section>

<!-- -------------------- FOOTER -------------------- -->
<footer>
    <div class="socials">
        <a href="https://discord.gg/pEHAbDnxUt" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/discord.svg" alt="Discord"></a>
        <a href="https://www.twitch.tv/league_amateur" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/twitch.svg" alt="Twitch"></a>
        <a href="https://www.youtube.com/channel/UCOJ9jdpurR-w60zUZFch1yw" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/youtube.svg" alt="YouTube"></a>
        <a href="https://www.tiktok.com/@league_amateur_cod" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg" alt="TikTok"></a>
        <a href="https://x.com/League_Amateur_" target="_blank"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg" alt="X"></a>
    </div>
</footer>

<!-- -------------------- MODAL ADMIN -------------------- -->
<div id="adminModal">
    <div class="modal-content">
        <h2 style="color:#FFD700;">Mode Admin</h2>
        <p>Veuillez entrer le code :</p>
        <div>
            <input type="password" id="adminCodeInput" placeholder="Code Admin">
            <button id="togglePassword" onclick="togglePassword()">üëÅÔ∏è</button>
        </div>
        <div style="margin-top:15px;">
            <button onclick="checkAdminCode()">Valider</button>
            <button onclick="closeAdminModal()" style="margin-left:10px; background:#555; color:#fff;">Annuler</button>
        </div>
    </div>
</div>

<!-- -------------------- MODAL INSCRIPTION + PAYPAL -------------------- -->
<div id="inscrireModal">
    <div class="modal-content">
        <h2 style="color:#FFD700;">S'inscrire au tournoi</h2>
        <p>Pour vous inscrire, veuillez payer 25‚Ç¨.<br>20‚Ç¨ pour la saison, 5‚Ç¨ pour le gagnant.</p>
        <input type="text" id="pseudoInput" placeholder="Votre pseudo" oninput="togglePaymentButton()">
        <button id="nextToPayment" onclick="showPaypalButton()" style="display:none; background-color:#FFD700; color:#000; border:none; padding:10px 15px; border-radius:5px; cursor:pointer; font-weight:bold; margin-top:8px;">Passer au paiement üí≥</button>
        <div id="paypal-button-container" style="margin-top:15px; display:none;"></div>
        <div style="margin-top:15px;">
            <button onclick="closeInscrireModal()" style="background:#555; color:#fff;">Annuler</button>
        </div>
    </div>
</div>

<!-- -------------------- SCRIPT PAYPAL + JS -------------------- -->
<script src="https://www.paypal.com/sdk/js?client-id=VOTRE_CLIENT_ID&currency=EUR"></script>
<script>
/* -------------------- VARIABLES -------------------- */
let adminMode = false;

/* -------------------- UTILITAIRES -------------------- */
function scrollToSection(id){ document.getElementById(id).scrollIntoView({ behavior:'smooth' }); }

/* -------------------- ADMIN MODAL -------------------- */
function openAdminModal(){
    document.getElementById('adminModal').style.display = 'flex';
    const input = document.getElementById('adminCodeInput');
    input.value = '';
    input.type = 'password';
    input.focus();
}
function closeAdminModal(){ document.getElementById('adminModal').style.display = 'none'; }
function togglePassword(){ const input = document.getElementById('adminCodeInput'); input.type = input.type === 'password' ? 'text' : 'password'; }

function showAdminAlert(message, type='success'){
    const alert = document.createElement('div');
    alert.className = `admin-alert ${type}`;
    alert.textContent = message;
    document.body.appendChild(alert);
    setTimeout(() => alert.remove(), 2500);
}

function checkAdminCode(){
    const code = document.getElementById('adminCodeInput').value.trim();
    if (code === "251220") {
        closeAdminModal();
        enableEditing();
        showAdminAlert("‚úÖ Mode Admin activ√©. Vous pouvez √©diter le contenu.", "success");
    } else {
        showAdminAlert("‚ùå Code incorrect !", "error");
    }
}

/* -------------------- √âDITEUR -------------------- */
const SIZE_ORDER = ['petit','moyen','grand'];
const SIZE_PX = { petit: '16px', moyen: '20px', grand: '24px' };
function getClosestSizeFromNode(node){
    while(node && node.nodeType === 1){
        if(node.hasAttribute && node.hasAttribute('data-size')){
            const s = node.getAttribute('data-size');
            if (SIZE_ORDER.includes(s)) return s;
        }
        node = node.parentElement;
    }
    return 'moyen';
}
function applySizeToSelection(direction){
    if (!adminMode) return;
    const sel = window.getSelection();
    if (!sel || !sel.rangeCount) return;
    const range = sel.getRangeAt(0);
    if (range.collapsed) return;
    const startNode = (range.startContainer.nodeType === 3) ? range.startContainer.parentElement : range.startContainer;
    let idx = SIZE_ORDER.indexOf(getClosestSizeFromNode(startNode));
    if (idx === -1) idx = 1;
    if (direction === 'increase' && idx < SIZE_ORDER.length - 1) idx++;
    if (direction === 'decrease' && idx > 0) idx--;
    const wrapper = document.createElement('span');
    wrapper.setAttribute('data-size', SIZE_ORDER[idx]);
    wrapper.style.fontSize = SIZE_PX[SIZE_ORDER[idx]];
    wrapper.appendChild(range.cloneContents());
    range.deleteContents();
    range.insertNode(wrapper);
    sel.removeAllRanges();
    const newRange = document.createRange();
    newRange.setStartAfter(wrapper);
    newRange.collapse(true);
    sel.addRange(newRange);
}
function formatText(command, event, btn){
    event = event || window.event;
    if(event && event.preventDefault) { event.preventDefault(); }
    if(event && event.stopPropagation) { event.stopPropagation(); }
    if (!adminMode) return;
    const content = btn.closest('.editable').querySelector('.editable-content');
    if (!content) return;
    content.focus();
    if (command === 'bold') document.execCommand('bold', false, null);
    else if (command === 'italic') document.execCommand('italic', false, null);
    else if (command === 'underline') document.execCommand('underline', false, null);
    else if (command === 'increaseFont') applySizeToSelection('increase');
    else if (command === 'decreaseFont') applySizeToSelection('decrease');
    saveContent(content);
}

/* -------------------- ACTIVER L'√âDITION -------------------- */
function enableEditing(){
    adminMode = true;
    document.querySelectorAll('.editable').forEach(el => {
        el.style.backgroundColor = 'rgba(75,0,130,0.5)';
        const toolbar = el.querySelector('.editor-toolbar');
        const content = el.querySelector('.editable-content');

        if (content) {
            content.setAttribute('contenteditable', 'true');

            content.addEventListener('focus', () => {
                if (adminMode && toolbar) toolbar.style.display = 'block';
            });

            content.addEventListener('blur', () => {
                setTimeout(() => { if (toolbar) toolbar.style.display = 'none'; }, 150);
                saveContent(content);
            });

            content.addEventListener('input', () => saveContent(content));
        }
    });

    document.querySelectorAll('.editor-toolbar button').forEach(btn => {
        btn.addEventListener('mousedown', e => e.preventDefault());
    });
}

async function saveContent(el){
    if (!adminMode) return;
    const contentId = el.parentElement.id;
    const contentHTML = el.innerHTML;
    try {
        const res = await fetch('/.netlify/functions/save', {
            method: 'POST',
            headers: { 'Content-Type':'application/json' },
            body: JSON.stringify({ id: contentId, content: contentHTML })
        });
        if (!res.ok) throw new Error('Impossible de sauvegarder le contenu');
    } catch(err) { 
        console.error('Erreur sauvegarde en ligne:', err);
        showAdminAlert('‚ùå Impossible de sauvegarder le contenu', 'error');
    }
}

/* -------------------- CHARGEMENT DU CONTENU DEPUIS L'API -------------------- */
document.addEventListener('DOMContentLoaded', async () => {
    document.querySelectorAll('.editable').forEach(async el => {
        const content = el.querySelector('.editable-content');
        if (!content) return;
        try {
            const res = await fetch(`/api/load?id=${el.id}`);
            if (!res.ok) throw new Error('Erreur serveur');
            const data = await res.json();
            if (data.content) content.innerHTML = data.content;
        } catch(err){ console.error('Erreur chargement en ligne:', err); }
        const toolbar = el.querySelector('.editor-toolbar');
        if (toolbar) toolbar.style.display = 'none';
    });
    document.querySelectorAll('.editor-toolbar button').forEach(btn => {
        btn.addEventListener('mousedown', e => e.preventDefault());
    });
});

/* -------------------- INSCRIPTION / PAYPAL -------------------- */
function openInscrireModal(){
    document.getElementById('inscrireModal').style.display = 'flex';
    document.getElementById('pseudoInput').value = '';
    document.getElementById('paypal-button-container').style.display = 'none';
    document.getElementById('nextToPayment').style.display = 'none';
}
function closeInscrireModal(){ document.getElementById('inscrireModal').style.display = 'none'; }
function togglePaymentButton(){
    const pseudo = document.getElementById('pseudoInput').value.trim();
    const btn = document.getElementById('nextToPayment');
    if(btn) btn.style.display = pseudo ? 'inline-block' : 'none';
}
function showPaypalButton(){
    const pseudoInput = document.getElementById('pseudoInput');
    const pseudo = pseudoInput ? pseudoInput.value.trim() : '';
    const container = document.getElementById('paypal-button-container');

    if (!pseudo) { alert("Veuillez entrer votre pseudo."); return; }
    if (container && container.innerHTML.trim() !== '') { container.style.display = 'block'; return; }
    if (container) container.style.display = 'block';

    paypal.Buttons({
        style: { label: 'pay' },
        createOrder: function(data, actions){
            return actions.order.create({ purchase_units: [{ amount: { value: '25.00' } }] });
        },
        onApprove: function(data, actions){
            return actions.order.capture().then(function(details){
                const finalPseudo = (document.getElementById('pseudoInput')?.value.trim()) || pseudo;
                alert(finalPseudo + " est bien inscrit au tournoi !");
                closeInscrireModal();
            });
        },
        onError: function(err){ alert("Erreur lors du paiement. Veuillez r√©essayer."); }
    }).render('#paypal-button-container');
}
</script>
</body>
</html>
